@page "/Post/{id:guid}"
@using DomainLayer.Constants
@using CodeConnect.WebAssembly.Components.General
@using DomainLayer.Helpers
@using CodeConnect.WebAssembly.Components.Posts
@inherits PostBase

@if (Post == null && Loading)
{
    <div class="w-full h-full flex justify-center items-center text-light-primaryColor">
        <FaIcon Icon="@FaIcons.Loading" />
    </div>
}
else
{
    if (Post != null)
    {
        <div class="w-[90vw] max-w-[1100px] bg-dark-secondaryColor rounded-md mx-auto pt-5 pb-[10px] mt-5 shadow-xl relative">
            @if (IsPostCreator)
            {
                <el-dropdown :trap-focus="false" class="inline-block absolute right-5 top-2">
                    <button class="inline-flex w-[50px] text-light-primaryColor p-2 bg-dark-primaryColor justify-center gap-x-1.5 rounded-md text-sm font-semibold cursor-pointer">
                        <FaIcon Icon="@FaIcons.Ellipsis" Size="@FaSize.Large"/>
                    </button>

                    <el-menu anchor="bottom end" class="w-56 origin-top-right rounded-md bg-dark-primaryColor shadow-lg ring-1 ring-black/5">
                        <div class="py-1">
                            <button @onclick="ToggleDeletPost" class="block px-4 py-2 text-sm text-light-primaryColor hover:bg-red-700 w-full cursor-pointer">
                                <FaIcon Icon="@FaIcons.Trash"/>
                                Delete Post
                            </button>
                        </div>
                    </el-menu>
                </el-dropdown>        
            }
            <div class="flex mt-[15px] w-[95%] justify-between text-[18px]">
                <div class="flex text-light-primaryColor ml-5 cursor-pointer" onclick="@(() => NavigationManager.NavigateTo($"/Profile/{Post.CreatedByUsername}"))">
                    <img src="@Post.UserImg" alt="@Post.CreatedByUsername" class="w-[50px] h-[50px] mr-5 rounded-full object-cover">
                    <div class="mt-[5px]">
                        <p class="font-bold hover:text-light-primaryColor"><span class="text-gray-400">&#64;</span>@Post.CreatedByUsername</p>
                    </div>
                </div>
                <p class="text-light-primaryColor/80 text-[14px] mt-[5px]">@Helpers.GetUsersLocalTime(Post.CreatedAtUtc, Consts.DateFormats.DateTimeFormat)</p>
            </div>
            <div class="w-[100%] text-[20px] font-bold mt-5 pl-5 relative rounded-md pr-5" id="@Id">
                @((MarkupString)Post.Content)
            </div>
            @if (Post.Images.Any())
            {
                <div class="flex flex-wrap mt-5 ml-5 mr-5">
                    @for (int i = 0; i < Post.Images.Count; i++)
                    {
                        var currentIndex = i;
                        <div key="@currentIndex" class="@(currentIndex == 0 ? "w-[100%] md:h-[400px] md:max-h-[400px]" : "md:w-[20%] w-[100%] mt-[5px] md:mr-[15px]") h-[200px] relative cursor-pointer">
                            <ImageViewer ImageUrl="@Post.Images[currentIndex]" Alt="@Post.Images[currentIndex]" ImageClass="rounded-md w-[100%] h-[100%] object-cover"/>
                        </div>
                    }
                </div>
            }
            <div class="flex ml-5 mt-[10px]">
                <div class="flex text-light-primaryColor/80">
                    <div class="cursor-pointer @(IsUserLiking ? "text-red-700" : "")" @onclick="ToggleLike">
                        <FaIcon Icon="@FaIcons.Heart" Size="@FaSize.Large"/>
                        <span><FormatNumber Number="LikeCount"/></span>
                    </div>
                    <div class="ml-[15px] cursor-pointer">
                        <FaIcon Icon="@FaIcons.Message" Size="@FaSize.Large"/>
                        <span><FormatNumber Number="Post.CommentCount"/></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="w-[90vw] max-w-[1100px] bg-dark-secondaryColor rounded-md mx-auto pt-5 pb-[10px] mt-5 shadow-xl relative pl-[10px]">
            <CascadingValue Value="@Post.Id">
                <h1 class="text-light-primaryColor font-bold text-[20px] mt-5">Comments</h1>
                <PostComments />
            </CascadingValue>
        </div>
    }
}
@if (ConfirmDeletePost)
{
    <Confirm Description="Are you sure you want to delete this post?" ConfirmText="Delete"  ConfirmMethod="DeletePost" CancelMethod="ToggleDeletPost"/>   
}
